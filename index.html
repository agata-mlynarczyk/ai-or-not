<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI vs Human Quiz</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";
        import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAzb29BLFBeOU6ikVM6-AZ7O1rQYczMgmM",
            authDomain: "ai-or-human-25519.firebaseapp.com",
            databaseURL: "https://ai-or-human-25519-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ai-or-human-25519",
            storageBucket: "ai-or-human-25519.appspot.com",
            messagingSenderId: "85813605872",
            appId: "1:85813605872:web:e7fe7dd37f31cc92171935"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        let userId = null; // To store user ID
        let score = 0; // User's score
        let texts = []; // Array to store questions and answers
        let currentTextIndex = -1; // Index for current text

        // Sign in the user anonymously
        signInAnonymously(auth)
            .then((userCredential) => {
                // Signed in 
                const user = userCredential.user;
                userId = user.uid; // Store user ID
                loadUserScore(userId); // Load user score from database
                fetchTexts(); // Fetch texts from JSON file
            })
            .catch((error) => {
                console.error('Error signing in:', error);
            });

        function loadUserScore(userId) {
            const scoreRef = ref(database, `scores/${userId}`);
            get(scoreRef)
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        score = snapshot.val().score; // Load existing score
                    } else {
                        score = 0; // Initialize score if not found
                    }
                    document.getElementById('score').innerText = score;
                })
                .catch((error) => {
                    console.error('Error getting user score:', error);
                });
        }

        function updateUserScore(userId, newScore) {
            const scoreRef = ref(database, `scores/${userId}`);
            set(scoreRef, {
                score: newScore
            }).then(() => {
                console.log('User score updated successfully');
            }).catch((error) => {
                console.error('Error updating score:', error);
            });
        }

        // Function to fetch texts from the JSON file
        async function fetchTexts() {
            try {
                const response = await fetch('texts.json'); // Load the texts from the JSON file
                if (!response.ok) throw new Error('Network response was not ok');
                texts = await response.json(); // Parse the JSON
                displayRandomText(); // Display the first text
            } catch (error) {
                console.error('Error fetching texts:', error);
            }
        }

        // Function to display a random text
        function displayRandomText() {
            if (texts.length === 0) return;

            const randomIndex = Math.floor(Math.random() * texts.length);
            currentTextIndex = randomIndex;
            const textObject = texts[randomIndex];
            document.getElementById('category-box').innerText = 'Category: ' + textObject.category;
            document.getElementById('text-box').innerText = textObject.text;
            document.getElementById('author-box').style.display = 'none';
            document.getElementById('ai-button').classList.remove('button-correct', 'button-incorrect');
            document.getElementById('human-button').classList.remove('button-correct', 'button-incorrect');
        }

        // Function to handle button click and update score
        function checkAnswer(userAnswer) {
            if (currentTextIndex === -1) return; // Ensure the game has started

            const correctAnswer = texts[currentTextIndex].answer;
            const isCorrect = userAnswer === correctAnswer;
            score += isCorrect ? 1 : -1; // Update score based on correctness

            // Show the author and update score
            document.getElementById('author-box').innerText = texts[currentTextIndex].author;
            document.getElementById('author-box').style.display = 'block';
            document.getElementById('score').innerText = score;

            // Update the user's score in the database
            updateUserScore(userId, score);

            // Highlight the buttons
            if (userAnswer === "AI") {
                document.getElementById('ai-button').classList.add(isCorrect ? 'button-correct' : 'button-incorrect');
                document.getElementById('human-button').classList.remove('button-correct', 'button-incorrect');
            } else {
                document.getElementById('human-button').classList.add(isCorrect ? 'button-correct' : 'button-incorrect');
                document.getElementById('ai-button').classList.remove('button-correct', 'button-incorrect');
            }

            // Load the next text after 1 second
            setTimeout(displayRandomText, 1000);
        }

        // Event listeners for the buttons
        document.getElementById('ai-button').addEventListener('click', () => checkAnswer("AI"));
        document.getElementById('human-button').addEventListener('click', () => checkAnswer("Human"));

    </script>
</head>
<body>
    <img src="ai_or_human_logo.png" alt="AI or Human Logo" id="logo">
    <div class="container">
        <div id="category-box" class="category-box">Category: N/A</div>
        <div id="text-box" class="text-box">Click a button to start!</div>
        <div id="author-box" class="author-box"></div>
        <div class="button-container">
            <button id="ai-button">ðŸ¤– AI</button>
            <button id="human-button">ðŸ§‘ Human</button>
        </div>
        <div class="score">Score: <span id="score">0</span></div>
    </div>
</body>
</html>
