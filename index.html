<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI vs Human Quiz</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <img src="ai_or_human_logo.png" alt="AI or Human Logo" id="logo">
    
    <!-- Top Ribbon -->
    <div class="top-ribbon">
        <h1>AI vs Human Quiz</h1>
        <div class="top-links">
            <span class="score">Score: <span id="score">0</span></span>
            <a href="leaderboard.html">Leaderboard</a>
        </div>
    </div>
    
    <div class="container">
        <div id="category-box" class="category-box">Category: N/A</div>
        <div id="text-box" class="text-box">Click a button to start!</div>
        <div id="author-box" class="author-box"></div>
        <div class="button-container">
            <button id="ai-button">ðŸ¤– AI</button>
            <button id="human-button">ðŸ§‘ Human</button>

        </div>
    </div>
    
    <!-- Bottom Ribbon -->
    <div class="bottom-ribbon">
        Created by <a href="https://www.linkedin.com/in/mlynarczyk-agata/">Agata Mlynarczyk</a> and <a href="https://www.linkedin.com/in/patrick-wakil/">Patrick Wakil</a>
    </div>
    
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
        import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Function to save or update user score in the database
        function saveUserScore(username, score) {
            const userRef = ref(database, 'users/' + username);
            set(userRef, { score: score }).then(() => {
                console.log("Score saved successfully for " + username);
            }).catch(error => {
                console.error("Error saving score: ", error);
            });
        }

        // Function to get the current score of a user
        function getUserScore(username) {
            const userRef = ref(database, 'users/' + username);
            return get(userRef).then(snapshot => {
                if (snapshot.exists()) {
                    return snapshot.val().score || 0;
                } else {
                    return 0; // If no score exists, start with 0
                }
            }).catch(error => {
                console.error("Error fetching user score:", error);
                return 0; // Default to 0 in case of error
            });
        }

        // Ask for the username on page load
        let username = prompt("Please enter your username:");
        let score = 0; // User's score

        // Retrieve and set the current score for the user
        getUserScore(username).then(userScore => {
            score = userScore;
            document.getElementById('score').innerText = score;
        });

        // Elements
        const categoryBox = document.getElementById('category-box');
        const textBox = document.getElementById('text-box');
        const authorBox = document.getElementById('author-box');
        const aiButton = document.getElementById('ai-button');
        const humanButton = document.getElementById('human-button');
        const scoreDisplay = document.getElementById('score');

        let texts = []; // Array to hold questions data
        let currentTextIndex = -1;

        // Fetch the text data from the external JSON file
        fetch('texts.json')
            .then(response => response.json())
            .then(data => {
                texts = data;
                displayRandomText(); // Start the game by displaying a random text after data is loaded
            })
            .catch(error => {
                console.error('Error loading texts:', error);
                textBox.innerText = "Failed to load questions!";
            });

        // Function to display a random text
        function displayRandomText() {
            if (texts.length === 0) return;

            const randomIndex = Math.floor(Math.random() * texts.length);
            currentTextIndex = randomIndex;
            categoryBox.innerText = 'Category: ' + texts[randomIndex].category;
            textBox.innerText = texts[randomIndex].text;
            authorBox.style.display = 'none'; // Hide author until answered
        }

        // Function to handle button click and update score
        function checkAnswer(userAnswer) {
            if (currentTextIndex === -1) return;  // Ensure the game has started
            
            const correctAnswer = texts[currentTextIndex].answer;
            const isCorrect = userAnswer === correctAnswer;
            score += isCorrect ? 1 : -1;  // Increment or decrement score based on correctness

            // Save updated score in Firebase
            saveUserScore(username, score);

            // Show the author and update score display
            authorBox.innerText = 'Author: ' + texts[currentTextIndex].author;
            authorBox.style.display = 'block';
            scoreDisplay.innerText = score;

            // Load the next text after 1 second
            setTimeout(displayRandomText, 1000);
        }

        // Event listeners for the buttons
        aiButton.addEventListener('click', () => checkAnswer("AI"));
        humanButton.addEventListener('click', () => checkAnswer("Human"));
    </script>
</body>
</html>
